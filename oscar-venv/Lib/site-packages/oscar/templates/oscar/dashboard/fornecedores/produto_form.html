{% extends 'fornecedores/base.html' %}

{% block dashboard_title %}
    {% if object %}Editar Produto{% else %}Adicionar Produto{% endif %}
{% endblock %}

{% block dashboard_content %}
<h2>Novo Produto</h2>
<form id="produtoForm">
  {% csrf_token %}
  <input type="text" name="nome" placeholder="Nome" required>
  <textarea name="descricao" placeholder="Descrição"></textarea>
  <input type="number" name="preco" placeholder="Preço" required>
  <select name="categoria_id">
    {% for cat in categorias %}
      <option value="{{ cat.id }}">{{ cat.nome }}</option>
    {% endfor %}
  </select>
  <input type="file" name="imagem">
  <select name="unidade_venda">
    <option value="kg">Kg</option>
    <option value="m2">m²</option>
    <!-- Adicione mais -->
  </select>
  <button type="submit">Salvar Produto</button>
</form>
{% block extra_js %}
<script>
document.getElementById("produtoForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const form = new FormData(this);
  const token = "{{ request.user.auth_token.key }}";  // ou token via sessão

  const response = await fetch("/api/produtos/", {
    method: "POST",
    headers: {
      "Authorization": `Token ${token}`,
    },
    body: form,
  });

  const data = await response.json();
  if (response.ok) {
    alert("Produto criado com sucesso!");
    window.location.href = "/dashboard/fornecedores/produtos/";
  } else {
    alert("Erro: " + JSON.stringify(data));
  }
});
</script>
{% endblock %}
{% endblock %}